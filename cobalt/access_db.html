<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>Using sendmail's access control list on your Cobalt</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
	<link rel="Stylesheet" rev="Stylesheet" href="../morse.css" />
</head>
<body>
<h1>The access control db</h1>
<h2>Using Sendmail to refuse connections from known spam sites using a local block 
 list </h2>
<p> Incoming mail to your Cobalt server arrives via the SMTP protocol. The sending 
 SMTP server connects to the mail port of your Cobalt, where your Mail Transit 
 Agent (MTA), <a href="http://www.sendmail.org">sendmail</a>, is listening. Sendmail 
 is perfectly happy to act as bouncer in your nightclub, but you do need to provide 
 it with a list of undesirable characters who need to be kept out.</p>
<p>When a remote host opens an SMTP connection, it sends some data to sendmail; 
 sendmail gets more information from the TCP software of your server about the 
 network origin of the connection. Sendmail will use this information to check 
 against the access control database and decide to allow or reject further traffic 
 on this connection. If the address is blocked, sendmail refuses mail and sends 
 an error message. If the address is not blocked, sendmail continues the mail 
 transfer normally.</p>
<p>The access control database is generated from the text file /etc/mail/access 
 in your Cobalt. The basic process works like this:</p>
<ol>
 <li>Edit /etc/mail/access</li>
 <li>Generate a new /etc/mail/access.db from /etc/mail/access.</li>
</ol>
<p>You can find more complete documentation of this feature of sendmail at <a href="http://www.sendmail.org">sendmail.org</a>.</p>
<h2>Edit /etc/mail/access</h2>
<p>I will assume you already know how to get a shell prompt from your Cobalt, 
 and how to edit text files on the server. You will probably need to be root in 
 order to edit this file.</p>
<p>The head of /etc/mail/access will look like this:</p>
<pre>#
# /etc/mail/access
#

# This file is automatically generated
# Please put custom changes at the end
# Cobalt Networks 1999

# Put custom additions below (Do not change/remove this line).


# Cobalt Access Section Begin</pre>
<p>Now, right here you will see some entries which came from the Cobalt GUI. This 
 will include a number of entries labeled RELAY, which specify which domains sendmail 
 should allow to relay; they probably include your own domain and possibly some 
 subnet addresses. Needless to say, follow the instructions and leave this bit 
 alone, until you reach the line which says:</p>
<pre>
# Cobalt Access Section End
</pre>
<p>OK, <b>now</b> you can make changes.</p>
<p>The format of this file is simple: domain, followed by a tab, followed by the 
 action for that domain. </p>
<p>The domain may be a domain name (arabia.com is one we have blocked by domain 
 name) or an IP subnet. A complete IP address blocks only that single IP. A partial 
 IP address will block all IPs in that subnet, so 66.163.35 is the equivalent 
 of blocking 66.163.35/24, or 66.163.35.0 through 66.163.35.255. </p>
<p>According to sendmail.org, actions for a listing &quot;can be REJECT to refuse 
 connections from this host, DISCARD to accept the message but silently discard 
 it (the sender will think it has been accepted), OK to allow access (overriding 
 other built-in checks), RELAY to allow access including relaying SMTP through 
 your machine, or an arbitrary message to reject the mail with the customized 
 message.&quot;</p>
<p>A few examples <a href="http://marc.theaimsgroup.com/?l=cobalt-users&amp;m=102553485202072&amp;w=2">were 
 posted</a> to the <a href="http://list.cobalt.com/mailman/listinfo/cobalt-users">cobalt-users 
 list</a> by Charlie Summers:</p>
<pre>yourwebcentral.com	REJECT


...will send a standard, "Permission Denied" error. If you want to
customize the error message received, you can do something like:

adv-data.com	572 Get Lost

...to reject mail from a single IP, try:

64.29.137.97	REJECT

...and, of course, if you want to avoid receiving mail from an entire
C-netblock _and_ send a customized error, you can do something like:

65.240.69	559 Drop Dead
</pre>
<p>Any line starting with a # is ignored, so you may use these to insert comments. 
 It's a good idea to note, if you're blocking a domain, why it's being blocked, 
 when you added it, and possibly even the nature of the spam. If you block a subnet, 
 note the specific IPs which were spam sources. This will help you back up your 
 assertions when someone complains, &quot;Why are we blocked? We never sent you 
 spam!&quot;</p>
<p>It has been my experience that blocking by IP is more effective than blocking 
 by domain, since few spammers give reliable domains when sending, and most domains 
 in spam headers will be forged. Look to the &quot;received&quot; lines in your 
 incoming spam, and block sources and relays. (Use comments to distinguish the 
 two.) You'll find more about reading spam headers and tracing the pink stuff 
 to its source at <a href="http://www.spamcop.net">SpamCop</a>, <a href="http://www.stopspam.org/email/headers/headers.html">stopspam.org</a>, 
 and <a href="http://www.doofus.org/spam/lessons/">doofus.org</a> (no kidding).</p>
<h2>Generating a new /etc/mail/access.db from /etc/mail/access</h2>
<p>This one's pretty simple. Once you've saved your /etc/mail/access and returned 
 to the prompt (but while you're still root), issue the following command:</p>
<pre># makemap hash access.db &lt; access</pre>
<p>Presto, you're done!</p>
<h2>Other /etc/mail/access tricks</h2>
<p style="border-bottom: 1px solid #000;">Charlie Summers - the Cobalt list's master of sendmail manipulation - also 
 <a href="http://marc.theaimsgroup.com/?l=cobalt-users&amp;m=102693302124794&amp;w=2">posted 
 instructions</a> on how to use the access control database to provide an informative 
 bounce for the address of a user who has moved on or a mailing list which has 
 closed. </p>
<p><a href="http://www.parkermorse.net/"> Parker Morse</a>, <a href="http://bluebird.sinauer.com/~morse/">resident 
 geek</a>, <a href="http://www.sinauer.com/">Sinauer Associates</a></p>
</body>
</html>
